# 機能仕様書: 強化版Slack Bot イベント幹事AIエージェント

**機能ブランチ**: `002-slack-bot-ai`
**作成日**: 2025-09-17
**ステータス**: ドラフト
**入力**: ユーザー記述: "# これは何か
複数人が集まる会（飲み会・ランチ・勉強会など）の幹事をしてくれるSlack Bot型のAIエージェント。

# 必要な機能
以下を自律的に、勝手に行ってくれる。
- 参加可否の確認：参加者にDMで確認
- 日程調整：参加者とDMで調整。会の目的によって妥当な日程と時間帯の候補を幾つか出す
- お店の予約：自律的に会の目的に沿ったお店選び
- カレンダーへの予定追加：参加者のGoogleカレンダーに予定を追加
- 会議室予約：自律的に開催予定時刻に空いているGoogleカレンダーの会議室を予約
- チャンネル内での周知：全て完了し、主催者への確認が済んだらチャンネルで周知

# 対象ユーザー
## 主催者
- 主催者

## 参加者
-  Botが追加されたチャンネル内の人
- メンションされた個人またはグループ

# 使い方
- チャンネル内に追加してメンションで呼び出す。
- 参加対象者をメンションで教える（@here/@channelは全員）
- 主催者に会の目的を聞き、必要な機能を洗い出して確認（過不足があれば主催者のフィードバックを元に修正する）
- 洗い出された各機能について、主催者の中間確認が必要かどうかをYes/ Noで確認

## 中間確認
以下の機能には中間確認を設定できる。
- 日程調整：候補日の確認。呼び出し投稿のスレッドで主催者に確認
- お店の予約：お店の候補。呼び出し投稿のスレッドで主催者に確認

# 最終確認
- 全ての作業が完了したら、内容の最終確認。呼び出し投稿のスレッドで主催者に確認
- 追加でフィードバックがあれば対応する

# ユースケース
以下は例です。
## 食事会
- 参加可否の確認
- 日程調整
- お店の予約
- カレンダーへの予定追加
- チャンネル内での周知

## 勉強会・MTG
- 日程調整
- カレンダーへの予定追加
- 会議室予約
- チャンネル内での周知"

## 実行フロー (main)
```
1. 入力からユーザー記述を解析
   → 空の場合: エラー "機能説明が提供されていません"
2. 記述から主要概念を抽出
   → 識別: アクター、アクション、データ、制約
3. 不明確な側面について:
   → [要明確化: 具体的な質問] でマーク
4. ユーザーシナリオとテスト セクションを記入
   → 明確なユーザーフローがない場合: エラー "ユーザーシナリオを特定できません"
5. 機能要件を生成
   → 各要件はテスト可能である必要
   → 曖昧な要件にマーク
6. 主要エンティティを識別（データが関与する場合）
7. レビューチェックリストを実行
   → [要明確化] がある場合: 警告 "仕様に不確実性があります"
   → 実装詳細が見つかった場合: エラー "技術詳細を削除してください"
8. 戻り値: 成功（仕様は企画準備完了）
```

---

## ⚡ クイックガイドライン
- ✅ ユーザーが「何を」「なぜ」必要とするかに焦点
- ❌ 「どのように」実装するかは避ける（技術スタック、API、コード構造なし）
- 👥 開発者向けではなく、ビジネス関係者向けに記述

### セクション要件
- **必須セクション**: すべての機能で完了必須
- **オプションセクション**: 機能に関連する場合のみ含める
- セクションが適用されない場合は、完全に削除する（"N/A" として残さない）

### AI生成用
ユーザープロンプトからこの仕様を作成する際:
1. **すべての曖昧さにマーク**: 仮定を立てる必要がある箇所は [要明確化: 具体的な質問] を使用
2. **推測しない**: プロンプトで特定されていないもの（例：認証方法のない"ログインシステム"）はマーク
3. **テスター視点で考える**: 曖昧な要件は「テスト可能で明確」チェックリスト項目で失格すべき
4. **よく未指定の領域**:
   - ユーザータイプと権限
   - データ保持/削除ポリシー
   - パフォーマンス目標と規模
   - エラーハンドリング動作
   - 統合要件
   - セキュリティ/コンプライアンス要件

---

## ユーザーシナリオとテスト *(必須)*

### メインユーザーストーリー
Slackチャンネルの主催者がイベント（飲み会、ランチ、勉強会など）を企画したいと考えています。参加者のメンションとともにAIボットをメンションすると、ボットが参加者確認（DM経由）、スケジュール調整（DMでのやり取り）、会場選択・予約、全参加者のGoogleカレンダー統合、会議室予約、主催者承認後のチャンネル内最終告知を含む、イベント調整プロセス全体を自律的に処理します。

### 受け入れシナリオ
1. **前提条件** 主催者が@here/@channelまたは特定ユーザー/グループのメンションとともにボットをメンションし、イベント目的を述べる、**実行時** ボットがリクエストを処理する、**期待結果** 必要な機能を特定し、主催者に確認して自律調整を開始する
2. **前提条件** ボットが参加者とイベントタイプを特定した、**実行時** 中間報告が必要かどうか確認する、**期待結果** 日程調整とお店の予約について中間報告の必要性が決まる
3. **前提条件** 必要な機能に参加者確認がある、**実行時** 参加者確認を開始する、**期待結果** 各参加者にDMを送信して参加の意思を確認する
4. **前提条件** 日程調整に中間報告が必要だと設定された、**実行時** イベント目的にとって妥当な日程と時間帯を算出する、**期待結果** スレッドで主催者に日程と時間帯を提案・確認する
5. **前提条件** 必要な機能に日程調整があり、参加者確認が完了した、**実行時** 日程調整を開始する、**期待結果** 各参加者にDMを送信して、イベント目的にとって妥当な日程と時間帯の候補を提案する
6. **前提条件** 店の予約に中間報告が必要だと設定された、**実行時** お店の検索をする、**期待結果** スレッドで主催者にお店を提案・確認する
7. **前提条件** 必要な機能にお店の予約があり、日程調整が完了した、**実行時** お店の予約を開始する、**期待結果** イベント目的にとって妥当なお店を自律的に選択・予約する
8. **前提条件** 必要な機能にカレンダーへの予定追加があり、日程調整が完了した、**実行時** カレンダーへの予定追加を開始する、**期待結果** 自律的にGogoleカレンダーに予定を追加する
9. **前提条件** すべての調整が完了した、**実行時** 最終確認を実行する、**期待結果** 全詳細を主催者にスレッドで提示し、承認を得る
10. **前提条件** 主催者の承認を得た、**実行時** イベント周知を実行する、**期待結果** 参加者にメンションをつけてチャンネルにイベント詳細を周知する

### エッジケース
- 参加者が合理的な期間内にDM確認リクエストに応答しない場合どうなるか？
 - 不参加とみなす。ただし代わりに主催者がDMで参加者の参加者確認や日程調整を行うことも可能。
- ボットは会場予約失敗や適切な会場が見つからない場合をどのように処理するか？
 - スレッドにて主催者に報告し、[主催者が代わりに行う/スキップ]の二択を選択してもらう。主催者が代わりに行う場合、完了次第ボットに報告するとその後のフローを継続する。
- 中間確認中に主催者が変更を要求した場合どうなるか？
 - 主催者の変更要件を明確にして、変更箇所を修正して実行フローをやり直す
- 一部の参加者でGoogleカレンダー統合が失敗した場合どうなるか？
 - DMでその参加者にGogoleカレンダーの予定のリンクを共有する

## 要件 *(必須)*

### 機能要件
- **FR-001**: システムは参加者指定（@here、@channel、または特定ユーザー、特定グループへのメンション）とともにSlackチャンネルでのボットメンションに応答しなければならない
- **FR-002**: システムは調整開始前に主催者とイベント目的/タイプを特定・確認しなければならない
- **FR-003**: システムはイベントタイプに基づいて必要な機能を決定し、主催者と確認しなければならない（フィードバックに基づく修正機能付き）
- **FR-004**: システムは主催者が日程調整とお店の予約の中間確認要件を設定できるようにしなければならない（Yes/No）
- **FR-005**: システムは参加者確認が必要な機能として決定さている場合、特定されたすべての参加者にDMを送信して参加の意思を確認しなければならない（参加したい/参加しない/未定）
- **FR-006**: システムは日程調整が必要な機能として決定さている場合、イベント目的/タイプに基づいて妥当な日程と時間帯を算出しなければならない
- **FR-007**: システムは日程調整に中間報告要件が設定されている場合、算出した日程と時間帯をスレッドで主催者に提案・承認を得なければならない（選択肢は10以上20以下）
- **FR-008**: システムは日程調整が必要な機能として決定さている場合、参加したいと解凍し人にのDMを送信して日程と時間帯を提示し参加可能かを確認しなければならない
- **FR-009**: システムはお店の予約が必要な機能として決定さていて日程調整が完了している場合、イベント目的/タイプに基づいて飲食店を自律的に検索しなければならない（ぐるなびAPI, Google Places APIを利用）
- **FR-010**: システムはお店の予約に中間報告要件が設定されている場合、調査した飲食店の候補をスレッドで主催者に提案・承認を得なければならない（5店舗以上10店舗以下、各飲食店の情報を簡単に要約しリンクも貼り付けておく）
- **FR-011**: システムはお店の予約が必要な機能として決定さていてお店が決定している場合、自律的に予約しなければならない（現状技術的に予約を自律的にはできないので、必ず主催者による手動対応フローを依頼すること）
- **FR-012**: システムは会議室予約が必要な機能として決定さている場合、自律的に参加者の人数が収容可能な会議室をGoogleカレンダーで予約しなければならない
- **FR-013**: システムはカレンダーへの予定追加が必要な機能として決定さている場合、参加者のGoogleカレンダーに予定を追加しなければならない
- **FR-014**: システムは調整されたすべての詳細を示すスレッドで主催者との最終確認を実行しなければならない
- **FR-015**: システムは主催者承認後にチャンネルで確定したイベント詳細を告知しなければならない
- **FR-016**: システムは確認済み参加者全員のイベントを追加するためGoogleカレンダーと統合しなければならない
- **FR-017**: システムは主催者によって設定された場合、スケジュールと会場選択の中間確認をスレッドで提供しなければならない
- **FR-018**: システムは適切な調整ワークフローで異なるイベントタイプ（食事イベント、勉強会、会議）をサポートしなければならない
- **FR-019**: システムはGoogleカレンダー統合の認証と権限を処理しなければならない（Slackアカウントに設定されているメールアドレスでOAuth2.0認証する。権限は参加者としてのRead権限。）
- **FR-020**: システムは参加者とのDMで要求があった場合、統合対象のGoogleアカウントの設定変更をしなければならない
- **FR-021**: システムは実行フローの途中で障害などにより処理を完了できない場合、主催者に[主催者が代わりに行う/スキップ]の二択の承認を得なければならない

### 主要エンティティ *(データが関与する機能の場合含める)*
- **イベント**: タイプ（食事、勉強、会議）、目的、参加者、日時、場所、調整ステータスを持つ計画された集まりを表す
- **主催者**: イベント企画を開始し、中間確認と最終確認の承認を提供するSlackユーザー
- **参加者**: 参加意思、参加可能な日程（都合）、確認ステータスを持つSlackチャンネルメンバーまたはメンションされたユーザー
- **会場**: 予約詳細、定員、イベントタイプへの適性を持つレストランまたは場所
- **カレンダーエントリ**: 出席者情報と会議室予約を持つGoogleカレンダーイベント
- **調整セッション**: 確認、スケジュール、予約、告知フェーズを通じた進捗を追跡する完全なワークフローインスタンス
- **中間確認**: 有効化時のスケジュール候補または会場選択の主催者承認チェックポイント

---

## レビューと受け入れチェックリスト
*ゲート: main()実行中に実行される自動チェック*

### コンテンツ品質
- [x] 実装詳細なし（言語、フレームワーク、API）
- [x] ユーザー価値とビジネス要件に焦点
- [x] 非技術系ステークホルダー向けに記述
- [x] すべての必須セクション完了

### 要件完全性
- [x] [要明確化] マーカーが残っていない
- [x] 要件がテスト可能で明確
- [x] 成功基準が測定可能
- [x] スコープが明確に境界付けられている
- [x] 依存関係と前提が識別されている

---

## 実行ステータス
*main()処理中に更新*

- [x] ユーザー記述解析
- [x] 主要概念抽出
- [x] 曖昧さマーク付け
- [x] ユーザーシナリオ定義
- [x] 要件生成
- [x] エンティティ識別
- [x] レビューチェックリスト合格

---